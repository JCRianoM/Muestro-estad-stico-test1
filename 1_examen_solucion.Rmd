---
title: "Examen 1: muestreo estídistico"
subtitle: "Unidad 1 y 2: muestreo aleatorio simple y muestro sistemático"
author: "Julián Camilo Riaño Moreno"
date: "`r format(Sys.Date(), '%A, %B %d, %Y')`"
output:
  pdf_document: 
    keep_tex: yes
    toc: yes
    toc_depth: 3
  html_document: 
    keep_md: true
    toc: yes
    toc_float: true
    code_folding: hide
  keep_tex: yes
  word_document: default
  fig_cap: yes
header-includes:
- \usepackage{float}
- \floatplacement{figure}{H}
---

```{r setup, include=FALSE}
# define knitr options
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(echo = TRUE, fig.pos= "h")
```

```{r intalación de paquetes y librerias, include=FALSE}
# instalar paquetes. 
library(dplyr)
library(readr)
library(tidyverse)
library(reshape)
library(ggplot2)
library(TeachingSampling)
library(Rmpfr)
library(pander) ##paquete para tablas pandoc
```

```{r carga de datos y construcción definir variables, include = FALSE}
### Lectura de datos
wine <- read.csv2("winequality-white.csv")
### se define una semilla ###
set.seed(123)

```

```{r Definición de funciones a muestreo Aleatorio simple , include=FALSE}
p_size_simple <- function(df_s, error) {
    df_s <- apply(df_s, 2, as.numeric)
    N_pop <- nrow(df_s)
    pil_size <- round(error*N_pop, 0)
        piloto_size_N <- data.frame(N_pop, pil_size)
    print(piloto_size_N)
    
}

### formula para tabla de estimadores aleatorio simple###
estm_pilot_simple <- function(df_data, error) {
    N_pop <- nrow(df_data) 
    pil_size <- round(error*N_pop, 0)
    ID_pl <- sample(1:N_pop, size=pil_size,replace=FALSE)
    pilot_num <- df_data[ID_pl, ]
    piloto_df <- apply(pilot_num, 2, as.numeric)
    piloto_df <- round(piloto_df, 3) 
    #aplicación de estimadores
        Media_var <- as.vector(apply(piloto_df, 2, mean))
        E.Error <- as.vector(Media_var*0.05)
        D.standard <- as.vector(apply(piloto_df, 2, sd))
        sd_med_var <-  as.vector(D.standard/Media_var)
    #Se construye df con los estimadores
    df_st <- data.frame(Media_var, D.standard, sd_med_var, E.Error)
    rownames(df_st) <- colnames(piloto_df)
    piloto_size_N <- data.frame(N_pop, pil_size)
    print(piloto_size_N)
    print(df_st) #impresion del data.frame
}

#### formula para tabla de errores ####

error_lst_simple <- function(data_est) {
    mar_1 <- seq(0,data_est[1, 4]+0.01,by=0.01)
    mar_2 <- seq(0,data_est[2, 4]+0.01, by=0.00065)
    mar_3 <- seq(0,data_est[3, 4], by=0.0005)
    mar_4 <- seq(0,data_est[4, 4]+0.01, by=0.0075)
    mar_5 <- seq(0,data_est[5, 4]+0.01, by=0.00035)
    mar_6 <- seq(0,data_est[6, 4]+0.001, by=0.05)
    mar_7 <- seq(0,data_est[7, 4], by=0.2)
    mar_8 <- seq(0,data_est[8, 4]+0.01, by=0.0015)
    mar_9 <- seq(0,data_est[9, 4], by=0.004)
    mar_10 <- seq(0,data_est[10, 4], by=0.0007)
    mar_11 <- seq(0,data_est[11, 4], by=0.015)
    mar_12 <- seq(0,data_est[12, 4], by=0.0075)
    f_list <- list(mar_1, mar_2, mar_3, mar_4, mar_5, mar_6, 
                   mar_7, mar_8, mar_9, mar_10, mar_11, mar_12)
    n.obs <- sapply(f_list, length)
    seq.max <- seq_len(max(n.obs))
    meta <- data.frame(sapply(f_list, "[", i = seq.max))
    colnames(meta) <- rownames(data_est)
    print(meta)
}


###### función gráfica sola ######
graph_inf.finite <- function(N, data_error, data_var, num_v, conf) {
    require(reshape)
    require(ggplot2)
    nam_v <- names(data_error[num_v])
    Z <- qnorm((1-conf)/2, mean = 0, sd = 1)
    Error_v_s <- na.omit(data_error[, num_v])
    sd_d <- data_var[num_v, 3]
    P_infinite_s <- ((Z^2)*sd_d^2)/Error_v_s^2
    P_finite_s <- P_infinite_s/(1+(P_infinite_s/N))
    tabl_e_s <- data.frame(Error_v_s, P_infinite_s, P_finite_s)
    ###melting para la gráfica####
    dat.melt <- melt(tabl_e_s, id.vars = "Error_v_s")
    ###inserta una elemento tipo gráfica de los errores###
    graph <-ggplot(dat.melt, aes(Error_v_s, value, colour = variable)) + 
        geom_point(size = 2) + 
        labs(title = 
                 paste('Muestreo por variable', '\"',nam_v, '\"'),
             y = 'Tamaño de muestra', 
             x = 'Errores', 
             caption = "Método = muestro aleatorio simple") +
        geom_line(linetype = "dashed")
    graph1 <- graph + 
        theme(plot.caption = element_text(hjust = 1, face = "italic"), 
              legend.title = element_blank(), 
              legend.position="bottom", legend.box = "horizontal")
    print(graph1)
}

#### formula para muestreo con gráfica ####
simple_inf.finite <- function(N, data_error, data_var, num_v, conf) {
    require(reshape)
    require(ggplot2)
    nam_v <- names(data_error[num_v])
    Z <- qnorm((1-conf)/2, mean = 0, sd = 1)
    Error_v_s <- na.omit(data_error[, num_v])
    sd_d <- data_var[num_v, 3]
    P_infinite_s <- ((Z^2)*sd_d^2)/Error_v_s^2
    P_finite_s <- P_infinite_s/(1+(P_infinite_s/N))
    tabl_e_s <- data.frame(Error_v_s, P_infinite_s, P_finite_s)
    ###melting para la gráfica####
    dat.melt <- melt(tabl_e_s, id.vars = "Error_v_s")
    ###inserta una elemento tipo gráfica de los errores###
    graph <-ggplot(dat.melt, aes(Error_v_s, value, colour = variable)) + 
        geom_point(size = 3) + 
        labs(title = 
                 paste('Muestreo por variable', '\"',nam_v, '\"'),
             y = 'Tamaño de muestra', 
             x = 'Errores', 
             caption = "Método = muestro aleatorio simple") +
        geom_line(linetype = "dashed")
    graph1 <- graph + 
        theme(plot.caption = element_text(hjust = 1, face = "italic"), 
              legend.title = element_blank(), 
              legend.position="bottom", legend.box = "horizontal")
    print(graph1)
    print(tabl_e_s)
}

# Formula para muestreo FINAL por método aleatorio simple
sam_final_simple <- function(data_original, muestra_sel) {
    require(TeachingSampling)
    N_pop <- nrow(data_original)
    sample_s <- sample(1:N_pop, size=muestra_sel,replace=FALSE)
    muestra_f <- data_original[sample_s, ]
    muestra_f <- (apply(muestra_f, 2, as.numeric))
    print(data.frame(muestra_f))
    
}

##### estimadores parte final ####

est_total_simple2<- function(n, df){
    require(TeachingSampling) # requiere este paquete y tener esta librería cargada
    N <- nrow(df)
    sample_1 <- sample(1:N, size=n,replace=FALSE) # se define muestreo a través de función sample
    df_f <- df[sample_1,] # se realiza muestreo sobre la base de datos original. 
    df_f <- apply(df_f, 2, as.numeric) # se hacen numericas todas las columnas
    df_f <- as.data.frame(df_f) # se pasa a data frame en caso que no lo sea
    table <- matrix(NA, nrow = 11, ncol = (dim(df_f)[2])) 
    rownames(table) = c('n', 'Int.Inferior', 'Media muestra', 'Int.Superior', 
                        'Desviacion std.','Varianza', 'Coeficiente var.',
                        'Int.Inferior total', 'Media Total', 
                        'Int.Superior Total', 'Varianza Total')
    colnames(table) <- names(df)
    for (k in 1:dim(df_f)[2]) {
        med_s <- mean(df_f[,k]) # se obtiene la media para todas las variables
        sd_s <- sd(df_f[,k]) # se obtiene la desviación para todas las variables
        Inf_int_s <- med_s - 2 * (sd_s/sqrt(n)) # se obtiene el intevalo inf de media para todas las variables
        Sup_int_s <- med_s + 2 * (sd_s/sqrt(n)) # se obtiene el intevalo sup de media para todas las variables
        Coef_var <- (sd_s/med_s) # se obtiene coef de variación para todas las variables
        var_var <- (sd_s^2/n)*((N-n)/N) # se obtiene la varianza para todas las variables
        med_total <- med_s*N # se obtiene la media total para todas las variables
        v_t <- var_var*N^2 # se obtiene la varianza total para todas las variables
        Inf_int_var <- med_s*N-2*sqrt(v_t) # se obtiene el intevalo inf media total para todas las variables
        Sup_int_var <- med_s*N+2*sqrt(v_t) # se obtiene el intevalo sup media total para todas las variables
        table[, k] <- c(n, Inf_int_s, med_s, Sup_int_s, sd_s, var_var,
                        Coef_var, Inf_int_var, med_total, Sup_int_var,v_t)
    }
    print(data.frame(t(table)))
}


```

```{r Definición de funciones a muestreo sistemático , include = FALSE}
### formula para tamaño de muestra piloto y Kp
p_size_sys <- function(df, error) {
    N_pop <- nrow(df)
    pil_size <- round(error*N_pop, 0)
    Kp <- round(N_pop/pil_size, 0)
    print(data.frame(N_pop, pil_size, Kp))
}

####formular para estimadores de piloto sistemático######
estm_pilot_sys <- function(df, N_pop, kp, N_confianza) {
    require(TeachingSampling)
    s_system <- S.SY(N_pop,kp) ### se requiere paquete TeachingSampling para función S.SY
    df_samp <- df[s_system,]
    ### ajuste de la base a datos númericos###
    s_num <- apply(df_samp, 2, as.numeric)
    s_num <- round(s_num, 3) ### evaluar si es necesario redondear
    #Se aplican primero estimadores#
        Media <- as.vector(apply(s_num, 2, mean))
        Error <- as.vector(Media*0.05)
        Varianza <- as.vector(apply(s_num, 2, var))
    #Se construye df con los estimadores
    df_st <- data.frame(Media, Error, Varianza)
        rownames(df_st) <- colnames(s_num)
    Z <- qnorm((1-N_confianza)/2, mean = 0, sd = 1) # valor Z
    #Se crean dos nuevas columnas con los tamaños por variable con y sin N
    Size_out_N <- round((Z^2*df_st$Varianza)/df_st$Error^2, 0)
    Size_with_N <- round(Size_out_N /(1+(Size_out_N/N_pop)),0)
    df_st <- cbind(df_st, Size_out_N, Size_with_N)
    print(df_st) #impresion del data.frame
}


#### Función errores ####
error_df_var <- function(data_est) {
    mar_1 <- seq(0,data_est[1, 2]+0.8,by=0.03)
    mar_2 <- seq(0,data_est[2, 2]+0.01, by=0.0006)
    mar_3 <- seq(0,data_est[3, 2], by=0.0004)
    mar_4 <- seq(0,data_est[4, 2]+0.1, by=0.01)
    mar_5 <- seq(0,data_est[5, 2]+0.001, by=0.00008)
    mar_6 <- seq(0,data_est[6, 2], by=0.045)
    mar_7 <- seq(0,data_est[7, 2]+0.9, by=0.2)
    mar_8 <- seq(0,data_est[8, 2]+0.01, by=0.0015)
    mar_9 <- seq(0,data_est[9, 2], by=0.004)
    mar_10 <- seq(0,data_est[10, 2], by=0.0006)
    mar_11 <- seq(0,data_est[11, 2], by= 0.015)
    mar_12 <- seq(0,data_est[12, 2], by=0.0075)
    f_list <- list(mar_1, mar_2, mar_3, mar_4, mar_5, mar_6, 
                   mar_7, mar_8, mar_9, mar_10, mar_11, mar_12)
    n.obs <- sapply(f_list, length)
    seq.max <- seq_len(max(n.obs))
    meta <- data.frame(sapply(f_list, "[", i = seq.max))
    colnames(meta) <- rownames(data_est)
    print(meta)
}

#### función para muestreo población finita e infinita ####

pob_inf.finite <- function(N, data_error, data_est, num_v, conf) {
    require(reshape)
    require(ggplot2)
    nam_v <- names(data_error[num_v])
    Z <- qnorm((1-conf)/2, mean = 0, sd = 1)
    Error_v <- na.omit(data_error[, num_v])
    var_d <- data_est[num_v, 3]
    P_infinite <- ((Z^2)*var_d)/Error_v^2
    P_finite <- P_infinite/(1+(P_infinite/N))
    tabl_e_s <- data.frame(Error_v, P_infinite, P_finite)
    ###melting para la gráfica####
        dat.melt <- melt(tabl_e_s, id.vars = "Error_v")
    ###inserta una elemento tipo gráfica de los errores###
    graph <-ggplot(dat.melt, aes(Error_v, value, colour = variable)) + 
            geom_point(size = 3) + 
            labs(title = 
                     paste('Muestreo por variable', '\"',nam_v, '\"'),
                 y = 'Tamaño de muestra', 
                 x = 'Errores',
                 caption = "Método = muestro sistemático") +
            geom_line(linetype = "dashed") 
    graph1 <- graph + 
        theme(plot.caption = element_text(hjust = 1, face = "italic"), 
              legend.title = element_blank(), 
              legend.position="bottom", legend.box = "horizontal")
    print(graph1)
    print(tabl_e_s)
}

###GRafica sola ####
Gr.sys_inf.finite <- function(N, data_error, data_est, num_v, conf) {
    require(reshape)
    require(ggplot2)
    nam_v <- names(data_error[num_v])
    Z <- qnorm((1-conf)/2, mean = 0, sd = 1)
    Error_v <- na.omit(data_error[, num_v])
    var_d <- data_est[num_v, 3]
    P_infinite <- ((Z^2)*var_d)/Error_v^2
    P_finite <- P_infinite/(1+(P_infinite/N))
    tabl_e_s <- data.frame(Error_v, P_infinite, P_finite)
    ###melting para la gráfica####
    dat.melt <- melt(tabl_e_s, id.vars = "Error_v")
    ###inserta una elemento tipo gráfica de los errores###
    graph <-ggplot(dat.melt, aes(Error_v, value, colour = variable)) + 
        geom_point(size = 2) + 
        labs(title = 
                 paste('Muestreo por variable', '\"',nam_v, '\"'),
             y = 'Tamaño de muestra', 
             x = 'Errores',
             caption = "Método = muestro sistemático") +
        geom_line(linetype = "dashed") 
    graph1 <- graph + 
        theme(plot.caption = element_text(hjust = 1, face = "italic"), 
              legend.title = element_blank(), 
              legend.position="bottom", legend.box = "horizontal")
    print(graph1)
    }




# Formula para muestreo FINAL
samp_final <- function(data_original, muestra_sel) {
    require(TeachingSampling)
    N_pop <- nrow(data_original)
    k_total <- round(N_pop/muestra_sel)
    sample_1 <- S.SY(N_pop, k_total)
    data_fin <- data_original[sample_1,]
    data_fin <- (apply(data_fin, 2, as.numeric))
    print(data.frame(data_fin))
    
}

#####función para obtención de estimadores finales ####
est_total_sys2<- function(n, df){
    require(TeachingSampling) # requiere este paquete y tener esta librería cargada
    N <- nrow(df)
    kp <- round(N/n)
    sample_1 <- S.SY(N, kp) # se define muestreon a través de función S.SY
    df_f <- df[sample_1,] # se realiza muestreo sobre la base de datos original. 
    df_f <- apply(df_f, 2, as.numeric) # se hacen numericas todas las columnas
    df_f <- as.data.frame(df_f) # se pasa a data frame en caso que no lo sea
    table <- matrix(NA, nrow = 12, ncol = (dim(df_f)[2])) 
    rownames(table) = c('n', 'kp', 'Int.Inferior', 'Media muestra', 'Int.Superior', 
                        'Desviacion std.','Varianza', 'Coeficiente var.',
                        'Int.Inferior total', 'Media Total', 
                        'Int.Superior Total', 'Varianza Total')
    colnames(table) <- names(df)
    for (k in 1:dim(df_f)[2]) {
        med_s <- mean(df_f[,k]) # se obtiene la media para todas las variables
        sd_s <- sd(df_f[,k]) # se obtiene la desviación para todas las variables
        Inf_int_s <- med_s - 2 * (sd_s/sqrt(n)) # se obtiene el intevalo inf de media para todas las variables
        Sup_int_s <- med_s + 2 * (sd_s/sqrt(n)) # se obtiene el intevalo sup de media para todas las variables
        Coef_var <- (sd_s/med_s) # se obtiene coef de variación para todas las variables
        var_var <- (sd_s^2/n)*((N-n)/N) # se obtiene la varianza para todas las variables
        med_total <- med_s*N # se obtiene la media total para todas las variables
        v_t <- var_var*N^2 # se obtiene la varianza total para todas las variables
        Inf_int_var <- med_s*N-2*sqrt(v_t) # se obtiene el intevalo inf media total para todas las variables
        Sup_int_var <- med_s*N+2*sqrt(v_t) # se obtiene el intevalo sup media total para todas las variables
        table[, k] <- c(n, kp, Inf_int_s, med_s, Sup_int_s, sd_s, var_var,
                        Coef_var, Inf_int_var, med_total, Sup_int_var,v_t)
    }
    print(data.frame(t(table)))
}

```

# Actividad

>Este conjunto de datos también está disponible en el repositorio de aprendizaje automático de [UCI (Universidad de California en Irvine)], (https://archive.ics.uci.edu/ml/datasets/wine+quality). Estos conjuntos de datos están relacionados con variantes rojas del vino portugués "Vinho Verde". Para más detalles, consulte la referencia [Cortez et al., 2009]. 

>Variables de entrada (basadas en pruebas fisicoquímicas):

1. fixed acidity
2. volatile acidity
3. citric acid
4. residual sugar
5. chlorides
6. free sulfur dioxide
7. total sulfur dioxide
8. density
9. pH
10. sulphates
11. alcohol
12. quality (score between 0 and 10)

>Lo contratan para hacer un análisis de muestreo con esta base de datos, con el objetivo de poder hacer un análisis descriptivo e inferencial. 

>Utilice el método de muestreo aleatorio simple y sistemático para determinar lo siguiente:


# Solución de la actividad

## Introducción y especificaciones generales

La base de datos entregada corresponde a un archivo que contiene 12 variables y 4898 observaciones. Por tal razón, se conoce el tamaño de la población que se está estudiante para este caso $N = 4898$. 

Para realizar los análisis de manera más eficiente se definieron 10 funciones para el muestreo aleatorio simple como para el muestro sistemático. que se pueden ver en los archivos en el siguiente repositorio propio de Github: (https://github.com/JCRianoM/Muestro-estad-stico-test1.git) 

Dichas funciones realizan el procesamiento visto en clase para una sola variable directamente para todas las variables, de esta forma la información en este documento será definida de esta misma forma. D

Dedido al procesamiento en formato: binary floating-point de *R*, algunas tablas se mostrarán en números flotantes. Si se desea hacer la verificación y comprobación de dichos números se puede utilizar la siguiente función propia que verifica data.frames a través de la función `mpfr` del paquete `Rmpfr` para manejo de números flotantes.


```{r Verificación de números flotantes, message=FALSE}
########## Revisión tablas con números flotantes ############
mpfr_zing <- function(df_revisar) {
    require(Rmpfr)
    matrix_float <- as.matrix(df_revisar)
    mpfr_x <- mpfr(matrix_float, precBits = 32)
    print(mpfr_x)}
#############################################################
```

Inicialmente se decide para este ejericio trabajar con un errro de $0.05$ y una nivel de confianza de $95%$. Para hacer los datos reproducibles se asigno un valor de estandar a traves de la función `set.seed  = 123`. 


## Muestreo Aleatorio simple

Inicialmente se realizó un análisis de muestreo para la prueba piloto. Para esto se tomaron todos las observaciones como población total y se aplicó un error de $0.05$, a través de esto, y como se puede observar en la tabla 1.  se obtuvo que el tamaño (n = `pil_size`) para el piloto es de $n = 245$. 

### Definición de la muestra piloto para cada variable

```{r tabla 1, include=FALSE}
tab_1 <- p_size_simple(wine, 0.05)
```

```{r Tabla para pilotos, echo=FALSE, message=FALSE, results='asis'}
pandoc.table(tab_1,
             caption = 'Tamaño población (N) y muestra (n) para el piloto',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r definición estimadores, include=FALSE}
est_aleat_simple <- estm_pilot_simple(wine, 0.05)
```

```{r estimadores del piloto, echo=FALSE, message=FALSE, results='asis'}
pandoc.table(est_aleat_simple,
             caption = 'Estimadores de la muestra piloto',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r tabla de errores aleatorio simple, include=FALSE}
e_list_simple <- error_lst_simple(est_aleat_simple)
```

```{r errores para el piloto aleatorio simple, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(e_list_simple,
             caption = 
                 'Tabla de margen de error para cada una de las variables',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r tabla de errores var1, include=FALSE}
v_1_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 1, 0.95)
```

```{r tabla gráfica var1, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_1_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 1: fixed acidity)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica var1, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 1'}
v_1_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 1, 0.95)
```

```{r tabla de errores var2, include=FALSE}
v_2_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 2, 0.95)
```

```{r tabla gráfica var2, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_2_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 2: volatile acidity)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica var2, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 2'}
v_2_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 2, 0.95)
```

```{r tabla de errores var3, include=FALSE}
v_3_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 3, 0.95)
```

```{r tabla gráfica var3, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_3_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 3: citric acid)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va3, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 3'}
v_3_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 3, 0.95)
```

```{r tabla de errores var4, include=FALSE}
v_4_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 4, 0.95)
```

```{r tabla gráfica var4, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_4_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 4: residual sugar)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va4, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 4'}
v_4_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 4, 0.95)
```

```{r tabla de errores var5, include=FALSE}
v_5_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 5, 0.95)
```

```{r tabla gráfica var5, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_5_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 5: chlorides)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va5, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 5'}
v_5_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 5, 0.95)
```

```{r tabla de errores var6, include=FALSE}
v_6_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 6, 0.95)
```

```{r tabla gráfica var6, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_6_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 6: free sulfur dioxide)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va6, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 6'}
v_6_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 6, 0.95)
```

```{r tabla de errores var7, include=FALSE}
v_7_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 7, 0.95)
```

```{r tabla gráfica var7, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_7_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 7: total sulfur dioxide)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va7, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 7'}
v_7_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 7, 0.95)
```

```{r tabla de errores var8, include=FALSE}
v_8_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 8, 0.95)
```

```{r tabla gráfica var8, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_8_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 8: density)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va8, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 8'}
v_8_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 8, 0.95)
```

```{r tabla de errores var9, include=FALSE}
v_9_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 9, 0.95)
```

```{r tabla gráfica var9, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_9_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 9: pH)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va9, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 9'}
v_9_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 9, 0.95)
```

```{r tabla de errores var10, include=FALSE}
v_10_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 10, 0.95)
```

```{r tabla gráfica var10, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_10_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 10: sulphates)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va10, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 10'}
v_10_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 10, 0.95)
```

```{r tabla de errores var11, include=FALSE}
v_11_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 11, 0.95)
```

```{r tabla gráfica var11, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_11_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 12: sulphates)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va11, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 11'}
v_11_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 11, 0.95)
```

```{r tabla de errores var12, include=FALSE}
v_11_simple <- simple_inf.finite(4898, e_list_simple, est_aleat_simple, 12, 0.95)
```

```{r tabla gráfica var12, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v_11_simple,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 12: sulphates)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica va12, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 12'}
v_12_simple <- graph_inf.finite(4898, e_list_simple, est_aleat_simple, 12, 0.95)
```


### Errores aceptados y definición de tamaño de muestra para cada variable.

```{r n y error para cada variable alea simple, echo=FALSE, message=FALSE, results='asis'}
### selección de n = para cada variable ####
Col_acept <- c('Error aceptado', 'Tamaño de muestra (n)')
Error_acp <- c(0.01, 0.0104, 0.011, 0.03, 0.01225, 0.05, 0.2, 0.0015, 0.004, 0.0077 , 0.015, 0.0075 )
n_sample <- c(600,  2089, 2093, 1765, 2895, 355,  7, 13, 543, 2142, 205, 1074)
df_ns_simples <- data.frame(Error_acp, n_sample)
colnames(df_ns_simples) <- Col_acept
rownames(df_ns_simples) <- names(wine)
panderOptions('missing', '---')
pandoc.table(df_ns_simples,
             caption = 
             'Tabla de errores aceptados y valores de tamaño de muestra (n)
             seleccionado para cada variable',
             digits = 4,
             split.table = Inf,
             align = 'r')
```


### Estimadores de las muestra finales utilizando el tamaño de muestra seleccionado para cada variable.

```{r estimadores finales simple 1, include=FALSE, echo=FALSE}
df_SIMPLE_final <- est_total_simple2(600, wine)

```

```{r estimadores finales simple_ 1, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 600$ resultado del piloto para la variable: fixed.acidity',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 2, include=FALSE, echo=FALSE}
df_SIMPLE_final2 <- est_total_simple2(2089, wine)

```

```{r estimadores finales simple_ 2, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final2,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 2089$ resultado del piloto para la variable: volatile.acidity',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 3, include=FALSE, echo=FALSE}
df_SIMPLE_final3 <- est_total_simple2(2093, wine)

```

```{r estimadores finales simple_ 3, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final3,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 2093$ resultado del piloto para la variable: citric.acid',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 4, include=FALSE, echo=FALSE}
df_SIMPLE_final4 <- est_total_simple2(1765, wine)

```

```{r estimadores finales simple_ 4, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final4,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 1765$ resultado del piloto para la variable: residual.sugar',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 5, include=FALSE, echo=FALSE}
df_SIMPLE_final5 <- est_total_simple2(2895, wine)

```

```{r estimadores finales simple_ 5, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final5,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 2895$ resultado del piloto para la variable: chlorides',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 6, include=FALSE, echo=FALSE}
df_SIMPLE_final6 <- est_total_simple2(355, wine)

```

```{r estimadores finales simple_ 6, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final6,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 355$ resultado del piloto para la variable: free.sulfur.dioxide',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 7, include=FALSE, echo=FALSE}
df_SIMPLE_final7 <- est_total_simple2(7, wine)

```

```{r estimadores finales simple_ 7, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final7,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 7$ resultado del piloto para la variable: total.sulfur.dioxide',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 8, include=FALSE, echo=FALSE}
df_SIMPLE_final8 <- est_total_simple2(13, wine)

```

```{r estimadores finales simple_ 8, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final8,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 13$ resultado del piloto para la variable: density',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 9, include=FALSE, echo=FALSE}
df_SIMPLE_final9 <- est_total_simple2(543, wine)

```

```{r estimadores finales simple_ 9, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final9,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 543$ resultado del piloto para la variable: pH',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 10, include=FALSE, echo=FALSE}
df_SIMPLE_final10 <- est_total_simple2(2142, wine)

```

```{r estimadores finales simple_ 10, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final10,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 2142$ resultado del piloto para la variable: sulphates',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 11, include=FALSE, echo=FALSE}
df_SIMPLE_final11 <- est_total_simple2(205, wine)

```

```{r estimadores finales simple_ 11, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final11,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 205$ resultado del piloto para la variable: alcohol',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r estimadores finales simple 12, include=FALSE, echo=FALSE}
df_SIMPLE_final12<- est_total_simple2(1074, wine)

```

```{r estimadores finales simple_ 12, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SIMPLE_final12,
             caption = 
             'Tabla estimadores de la muestra y totales 
             usando el valor de $n = 1074$ resultado del piloto para la variable: quality',
             digits = 4,
             split.table = 125,
             align = 'r')
```

# Conclusiones y comentarios de muestreo aleatorio simple

Se llevó acabo un análisis de muestreo aleatorio simple; se obtuvo inicialmente el tamaño de muestre de la prueba piloto como se indicó anteriomente (tabla 1.), seguidamente se realizó una análisis de estimadores (tabla 2.) y a través de este procedimiento se obtuvo el "error estimado" para cada una de las variables del piloto. 

Se construyó una tabla de "margenes de error" para los errores estimados" (tabla 3.), debido a las unidades y los números manejados para cada una de las variables, las secuencias de errores se estableció de manera independiente para cada variable. 

Con esta tabla, se siguió a un análisis del estimado del tamaño muestral por método basado en población finita e infinita. Para cada una de las variables se obtuvo una tabla de errores y los posibles tamaños de muestra para población infinita (P_infinite_s) y población finita (P_finite_s), Las gráficas obtenidas van desde la 1 a la 12 y las tablas, desde la 4 a la 15. 

Con esta información se decidió tomar un valor de tamaño muestra posible con la aceptación de un grado de error para cada variable. La **tabla 16** muestra estos resultados. Como se puede observa existen variables que presentan valores muy bajos de tamaño muestral como `total.sulfur.dioxide` ($n = 7$), esto puede ser dado a la poca varianza de esta variable, como se observa en la tabla 2. Para las otras variables se decidió tomar una muestra casi intermedia de la población total; claramente esta selección que parece arbitraría, se debe definir con otras variables que no dependen de este análisis (económicas, recursos, etc.). El criterio de selección acá fue la minimización máxima del error aceptado con la inclusión de mayor cantidad de personas. 

Finalmente, se realizó un remuestreo a través de un método aleatorio simple en la población original, utilizan los tamaños de muestra (n) obtenidos en el análisis de la prueba piloto. A estos nuevos muestreos que acá llamaré muestreos finales, se le hallaron los estimadores finales de cada variable, a saber: `Int.Inferior`, `Media.muestra`, `Int.Superior`, `Desviacion.std.`, `Varianza`, `Coeficiente.var.`, `Int.Inferior.total`, `Media.Total`, `Int.Superior.Total`, `Varianza.Total`. Este procedimiento se realizó para el tamaño de muestra (n) obtenido de cada una de las variables. 
Estos resultados reposan en las **tablas 17 a la 39**. 

#####################################################################################

## Muestreo sistematico

Para este análisis de muestreo sistemático se tomaron todos las observaciones como población total y se aplicó un error de $0.05$, a través de esto, y como se puede observar en la tabla 1.  se obtuvo que el tamaño (n = `pil_size`) para el piloto es de $n = 245$ y un valor $k = 20$ (se uso el mismo valor de semilla para este muestreo), ver tabla 19. 

### Definición de la muestra piloto para cada variable (muestreo sistemático)

```{r tabla 1 sys, include=FALSE}
tab_2 <- p_size_sys(wine, 0.05)
```

```{r Tabla para pilotos sys, echo=FALSE, message=FALSE, results='asis'}
pandoc.table(tab_2,
             caption = 'Tamaño población (N) y muestra (n) 
             para el piloto (muestreo sistemático',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r definición estimadores sys, include=FALSE}
tab_est <- estm_pilot_sys(wine, 4898, 20, 0.95)
```

```{r estimadores del piloto sys, echo=FALSE, message=FALSE, results='asis'}
pandoc.table(tab_est,
             caption = 'Estimadores de la muestra piloto por muestreo sistemático (size_out_N = estimación pop. infinita; size_with_N = estimación pop. finita)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r tabla de errores aleatorio simple sys, include=FALSE}
e_list <- error_df_var(tab_est)
```

```{r errores para el piloto aleatorio simple sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(e_list,
             caption = 
                 'Tabla de margen de error para cada una de las variables',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r tabla de errores var1 sys, include=FALSE}
v1_sys <- pob_inf.finite(4898, e_list, tab_est, 1, 0.95)
```

```{r tabla gráfica var1 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v1_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 1: fixed acidity)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica var1 sys1, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 1'}
Gr.sys_inf.finite(4898, e_list, tab_est, 1, 0.95)
```

```{r tabla de errores var2 sys, include=FALSE}
v2_sys <- pob_inf.finite(4898, e_list, tab_est, 2, 0.95)
```

```{r tabla gráfica var2 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v2_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 2: volatile acidity)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica var2 sys2, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 2'}
Gr.sys_inf.finite(4898, e_list, tab_est, 2, 0.95)
```

```{r tabla de errores var3 sys, include=FALSE}
v3_sys <- pob_inf.finite(4898, e_list, tab_est, 3, 0.95)
```

```{r tabla gráfica var3 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v3_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 3: citric acid)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys3, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 3'}
Gr.sys_inf.finite(4898, e_list, tab_est, 3, 0.95)
```

```{r tabla de errores var4 sys, include=FALSE}
v4_sys <- pob_inf.finite(4898, e_list, tab_est, 4, 0.95)
```

```{r tabla gráfica var4 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v4_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 4: residual sugar)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys4, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 4'}
Gr.sys_inf.finite(4898, e_list, tab_est, 4, 0.95)
```

```{r tabla de errores var5 sys, include=FALSE}
v5_sys <- pob_inf.finite(4898, e_list, tab_est, 5, 0.95)
```

```{r tabla gráfica var5 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v5_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 5: chlorides)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys5, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 5'}
Gr.sys_inf.finite(4898, e_list, tab_est, 5, 0.95)
```

```{r tabla de errores var6 sys, include=FALSE}
v6_sys <- pob_inf.finite(4898, e_list, tab_est, 6, 0.95)
```

```{r tabla gráfica var6 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v6_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 6: free sulfur dioxide )',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys6, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 6'}
Gr.sys_inf.finite(4898, e_list, tab_est, 6, 0.95)
```

```{r tabla de errores var7 sys, include=FALSE}
v7_sys <- pob_inf.finite(4898, e_list, tab_est, 7, 0.95)
```

```{r tabla gráfica var7 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v7_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 7: total sulfur dioxide)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys7, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 7'}
Gr.sys_inf.finite(4898, e_list, tab_est, 7, 0.95)
```

```{r tabla de errores var8 sys, include=FALSE}
v8_sys <- pob_inf.finite(4898, e_list, tab_est, 8, 0.95)
```

```{r tabla gráfica var8 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v8_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 8: density)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys8, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 8'}
Gr.sys_inf.finite(4898, e_list, tab_est, 8, 0.95)
```

```{r tabla de errores var9 sys, include=FALSE}
v9_sys <- pob_inf.finite(4898, e_list, tab_est, 9, 0.95)
```

```{r tabla gráfica var9 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v9_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 9: pH)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys9, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 9'}
Gr.sys_inf.finite(4898, e_list, tab_est, 9, 0.95)
```

```{r tabla de errores var10 sys, include=FALSE}
v10_sys <- pob_inf.finite(4898, e_list, tab_est, 10, 0.95)
```

```{r tabla gráfica var10 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v10_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 10: sulphates)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys10, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 10'}
Gr.sys_inf.finite(4898, e_list, tab_est, 10, 0.95)
```

```{r tabla de errores var11 sys, include=FALSE}
v11_sys <- pob_inf.finite(4898, e_list, tab_est, 11, 0.95)
```

```{r tabla gráfica var11 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v11_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 11: alcohol)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys11, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 11'}
Gr.sys_inf.finite(4898, e_list, tab_est, 11, 0.95)
```

```{r tabla de errores var12 sys, include=FALSE}
v12_sys <- pob_inf.finite(4898, e_list, tab_est, 12, 0.95)
```

```{r tabla gráfica var12 sys, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(v12_sys,
             caption = 
                 'Tabla de margen de error y 
             tamaños de muestra estimados para población infinita y finita
             (variable 12: quality)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```

```{r grafica sys12, echo=FALSE, message=FALSE, results='asis', fig.cap= 'Gráfica comparación muestra para población infinita y finita Variable 12'}
Gr.sys_inf.finite(4898, e_list, tab_est, 12, 0.95)
```


### Errores aceptados y definición de tamaño de muestra para cada variable (muestreo sistemático).


```{r n y error para cada variable SYS, echo=FALSE, message=FALSE, results='asis'}
### selección de n = para cada variable ####
Col_acept_sys <- c('Error aceptado', 'Tamaño de muestra (n)')
Error_acp_sys <- c(0.03, 0.003, 0.004, 0.16, 0.00072, 0.54, 1.6, 0.0015, 0.008, 0.0036, 0.045, 0.0375)
n_sample_sys <- c(1971,  2056, 2021, 2113, 1990, 2125,  1856, 15, 1021, 2000, 1743, 1560)
df_ns_sys <- data.frame(Error_acp_sys, n_sample_sys)
colnames(df_ns_sys) <- Col_acept_sys
rownames(df_ns_sys) <- names(wine)
panderOptions('missing', '---')
pandoc.table(df_ns_sys,
             caption = 
             'Tabla de errores aceptados y valores de tamaño de muestra (n)
             seleccionado para cada variable (muestreo sistemático)',
             digits = 4,
             split.table = Inf,
             align = 'r')
```


### Estimadores de las muestra finales utilizando el tamaño de muestra seleccionado para cada variable (muestreo sistemático)

```{r cosa final, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final <- est_total_sys2(1971, wine)
```

```{r estimadores finales sys1, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 1971$ resultado del piloto para la variable: fixed.acidity',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 2, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final2 <- est_total_sys2(2056, wine)
```

```{r estimadores finales sys2, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final2,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 2056$ resultado del piloto para la variable: volatile.acidity',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 3, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final3 <- est_total_sys2(2021, wine)
```

```{r estimadores finales sys3, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final3,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 2021$ resultado del piloto para la variable: citric.acid',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 4, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final4 <- est_total_sys2(2113, wine)
```

```{r estimadores finales sys4, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final4,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 2113$ resultado del piloto para la variable: residual.sugar',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 5, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final5 <- est_total_sys2(1990, wine)
```

```{r estimadores finales sys5, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final5,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 1990$ resultado del piloto para la variable: chlorides',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 6, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final6 <- est_total_sys2(2125, wine)
```

```{r estimadores finales sys6, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final6,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 2125$ resultado del piloto para la variable: free.sulfur.dioxide',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 7, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final7 <- est_total_sys2(1856, wine)
```

```{r estimadores finales sys7, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final7,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 1856$ resultado del piloto para la variable: total.sulfur.dioxide ',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 8, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final8 <- est_total_sys2(15, wine)
```

```{r estimadores finales sys8, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final8,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 15$ resultado del piloto para la variable: density ',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 9, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final9 <- est_total_sys2(1021, wine)
```

```{r estimadores finales sys9, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final9,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 1021$ resultado del piloto para la variable: pH ',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 10, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final10 <- est_total_sys2(2000, wine)
```

```{r estimadores finales sys10, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final10,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 2000$ resultado del piloto para la variable: sulphates ',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 11, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final11 <- est_total_sys2(1743, wine)
```

```{r estimadores finales sys11, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final11,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 1743$ resultado del piloto para la variable: alcohol ',
             digits = 4,
             split.table = 125,
             align = 'r')
```

```{r cosa final 12, echo=FALSE, message=FALSE, include=FALSE, results='asis'}
df_SYS_final12 <- est_total_sys2(1560, wine)
```

```{r estimadores finales sys12, echo=FALSE, message=FALSE, results='asis'}
panderOptions('missing', '---')
pandoc.table(df_SYS_final12,
             caption = 
             'Tabla estimadores (muestreo sistemático) de la muestra y totales 
             usando el valor de $n = 1560$ resultado del piloto para la variable: quality ',
             digits = 4,
             split.table = 125,
             align = 'r')
```



# Conlusiones y comentarios del muestreo sistemático
En la segunda parte de esta actividad, se llevó acabo un análisis de muestreo sistemático; se obtuvo inicialmente el tamaño de muestre de la prueba piloto como se indicó anteriomente (tabla 41.), además se obtuvo un valor de $Kp = 20$ para la piloto. Seguidamente se realizó una análisis de estimadores (tabla 42.) y a través de este procedimiento se obtuvo el "error estimado" para cada una de las variables del piloto. 

Se construyó una tabla de "margenes de error" para los errores estimados" (tabla 43.), debido a las unidades y los números manejados para cada una de las variables, las secuencias de errores se estableció de manera independiente para cada variable. 

Con esta tabla, se siguió a un análisis del estimado del tamaño muestral por método basado en población finita e infinita. Para cada una de las variables se obtuvo una tabla de errores y los posibles tamaños de muestra para población infinita (P_infinite_s) y población finita (P_finite_s), Las gráficas obtenidas van desde la 13 a la 24 y las tablas, desde la 44 a la 55. 

Con esta información se decidió tomar un valor de tamaño muestra posible con la aceptación de un grado de error para cada variable. La **tabla 56** muestra estos resultados. Como se puede observa existen variables que presentan valores muy bajos de tamaño muestral como `density` ($n = 15$), esto puede ser dado a la poca varianza de las observaciones obtenidas por este muestreo para el pilot, como se observa en la tabla 42. Para las otras variables se decidió tomar una muestra casi intermedia de la población total; claramente esta selección que parece arbitraría, se debe definir con otras variables que no dependen de este análisis (económicas, recursos, etc.). El criterio de selección acá fue la minimización máxima del error aceptado con la inclusión de mayor cantidad de personas. 

Finalmente, se realizó un remuestreo a través de un método aleatorio simple en la población original, utilizan los tamaños de muestra (n) obtenidos en el análisis de la prueba piloto. A estos nuevos muestreos que acá llamaré muestreos finales, se le hallaron los estimadores finales de cada variable, a saber: `Int.Inferior`, `Media.muestra`, `Int.Superior`, `Desviacion.std.`, `Varianza`, `Coeficiente.var.`, `Int.Inferior.total`, `Media.Total`, `Int.Superior.Total`, `Varianza.Total`. Este procedimiento se realizó para el tamaño de muestra (n) obtenido de cada una de las variables. 
Estos resultados reposan en las **tablas 57 a la 79**. 
